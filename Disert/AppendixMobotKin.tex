% Приложение - Вывод кинематических уравнений движения маяка в поле
%              зрения видеокамеры мобильного робота

%\chapter{Вывод кинематических уравнений движения маяка в поле
%         зрения видеокамеры мобильного робота}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Связь вращения колес с движением робота}

Рассмотрим кинематическую связь скорости вращения ведущих колес с
движением робота.  Считаем, что колеса не проскальзывают и в течение
одного кванта времени вращаются с постоянной угловой скоростью.

Путь, пройденный колесом радиуса $\rho$ при вращении на угол $\phi$,
равен $p=2\phi\rho$.  При вращении с постоянными угловыми скоростями
$\omega_L$, $\omega_R$ в течение кванта времени $\dt$ колеса
пройдут пути:

\begin{equation}\label{eq:moby-path1}
\left\{
\begin{array}{rcl}
p_L & = & 2\omega_L\dt\rho \\
p_R & = & 2\omega_R\dt\rho
\end{array}
\right.
\end{equation}

Если угловые скорости вращения колес совпадают, то робот движется по
прямой вперед или назад.  Если скорости вращения различны, движение
робота будет складываться из поступательного и вращательного.  Положим
для определенности что $\omega_L>\omega_R$.  В этом случае движение
можно представить как вращение вокруг некоторой точки $C$ с
радиус-вектором $r$.  На~\figref{fig:moby_rotate} представлена схема
такого движения в два последовательных момента времени $t_k$ и
$t_{k+1}=t_k+\dt$.

\begin{figure}[h]
\centerline{\hbox{\psfig{figure=moby_rotate.eps}}}
\caption{Вращательно-поступательное движение мобильного робота}
\label{fig:moby_rotate}
\end{figure}

Известно, что при постоянных скоростях вращения колес движение вокруг
точки $C$ тоже будет проходить с постоянной угловой скоростью
$\omega$.  Радиус-вектор длины $r$, исходящий из точки $C$ $O_k$, за
время кванта времени $\dt$ переместится из точки $O_k$ в точку
$O_{k+1}$.

Точки $L_k$ и $R_k$ пройдут следующий путь:

\begin{equation}\label{eq:moby-path2}
\left\{
\begin{array}{rcl}
p_L & = & 2(r+b/2)\omega\dt \\
p_R & = & 2(r-b/2)\omega\dt
\end{array}
\right.
\end{equation} где $b$ --- колесная база робота, т.е. длина отрезка $L_kR_k$

Считая $\omega_L$, $\omega_R$ и геометрические параметры робота
заданными, из \eqref{eq:moby-path1} и \eqref{eq:moby-path2} получим
выражения для $\omega$ и $r$:

\begin{equation}\label{eq:moby-wheel-to-move}
\begin{array}{rcl}
r & = & b\,\displaystyle\frac{\omega_L+\omega_R}{\omega_L-\omega_R} \\
\omega & = & \displaystyle\frac{\rho}{2b}(\omega_L-\omega_R)
\end{array}
\end{equation}


\section{Движение маяка в поле зрения робота}

По мере движения робота координаты маяка в поле зрения видеокамеры
будут меняться.  В зависимости от расстояния до маяка он может
оказаться перед колесами робота (маяк в точке $A$
на~\figref{fig:moby_and_lamp}) или между колесами робота и
видеокамерой (маяк в точке $B$ на~\figref{fig:moby_and_lamp}).

\begin{figure}[h]
\centerline{\hbox{\psfig{figure=moby_and_lamp.eps}}}
\caption{Два случая взаимного расположения робота и маяка лампы (вид справа)}
\label{fig:moby_and_lamp}
\end{figure}

Целесообразно рассмотреть эти случаи отдельно, так как в них влияние
$\omega_L$ и $\omega_R$ на движение маяка в поле зрения робота
качественно различается.  Первый случай назовем ``далеким''
расположением маяка, второй --- ``близким''.

Установим зависимость угловой координаты маяка $\alpha$ от скоростей
вращения колес $\omega_L$ и $\omega_R$, считая, что в течение кванта
времени $\dt$ они постоянны.  Характерные точки в начале кванта времени
обозначим индексом $k$, а в конце --- индексом $k+1$.

\subsection{Случай ``далекого'' расположения маяка}

Схема движения представлена на~\figref{fig:moby_eye_move_far}.
Выразим $\alpha_{k+1}$ через $\alpha_k$, параметры поворота робота и
его геометрические размеры, зная действительное расстояние до маяка.

В начале рассматриваемого кванта времени проекцией маяка $A$ на ось
нулевого углового отклонения $E_kS$ является точка $D_k$.  Обозначим
расстояние расстояние от оси колес до точки $D_k$ (отрезок $O_kD_k$)
через $d_k$, а расстояние от видеокамеры до оси колес (отрезок
$O_kE_k$) --- через $f$.  Введем аналогичные обозначения в конце
кванта времени, применив индекс $k+1$.  Применяя обозначения имеем
длину отрезков $E_kD_k$ и $E_{k+1}D_{k+1}$:

$$
\begin{array}{rcl}
E_kD_k & = & d_k+f\\
E_{k+1}D_{k+1} & = & d_{k+1}+f
\end{array}
$$

Как уже отмечалось, движение колес с постоянной угловой скоростью
приводит к вращению робота вокруг точки $C$.  При повороте робота на
угол $\phi$ угловая координата маяка изменится с $\alpha_k$ на
$\alpha_{k+1}$.  Поскольку вращение происходит по окружности, оси
нулевых отклонений в моменты $t_k$ и $t_{k+1}$ пересекутся в точке
$Q$, лежащей на биссектрисе угла поворота $\angle O_kCO_{k+1}=\phi$.

Поскольку угол между осью нулевого отклонения и осью вращения колес
$L_kR_k$ прямой, то

\begin{equation}\label{eq:g-computation}
g=O_kQ=QO_{k+1}=r\tan\frac{\phi}{2}
\end{equation} где $r$ --- длина радиус-вектора
поворота~\eqref{eq:moby-wheel-to-move}.

\begin{figure}[t]
\centerline{\hbox{\psfig{figure=moby_eye_move_far.eps}}}
\caption{Изменение угловой координаты маяка при движении робота ``далеко'' от
         маяка}
\label{fig:moby_eye_move_far}
\end{figure}

Рассмотрим прямоугольный треугольник $\triangle D_kE_kA$.  В нем
$D_kA=D_kE_k\tan\alpha_k=(d_k+f)\tan\alpha_k$.

В прямоугольном треугольнике $\triangle SD_kA$ сторона
$SD_k=D_kA\tan\phi \quad\Rightarrow\quad
SD_k=(d_k+f)\tan\alpha_k\tan\phi$.

Найдем $SQ$ --- гипотенузу $\triangle SD_{k+1}Q$:

$$
\begin{array}{rcl}
SQ & = & SD_k+D_kQ\\
D_kQ & = & D_kO_k-O_kQ=d_k-g\\
SQ & = & (d_k+f)\tan\alpha_k\tan\phi+d_k-g
\end{array}
$$

Катет $D_{k+1}Q$ этого треугольника образуется суммой $d_{k+1}+g$ из
которой надо найти $d_{k+1}$ --- расстояние от маяка до оси вращения
колес:

$$
d_{k+1}=D_{k+1}Q-g=SQ\sin\phi-g
$$

Подставляем значение $SQ$:

\begin{equation}\label{dk+1-computation}
d_{k+1}=\Bigl((d_k+f)\tan\alpha_k\tan\phi+d_k-g\Bigr)\sin\phi-g
\end{equation}

Рассмотри прямоугольный $\triangle D_{k+1}AP$.  Его гипотенуза
$PA=D_kA-D_kP$, где $D_kA$ --- катет $\triangle D_kAE_k$, а $D_kP$ ---
катет $\triangle D_kPQ$.  Вычисляя длины этих катетов и подставляя в
выражение для гипотенузы $\triangle D_{k+1}AP$ получим:

$$
PA=(d_k+f)\tan\alpha_k+(d_k-g)\tan\phi
$$

Соответственно, катет $D_{k+1}A$ этого треугольника:

$$
D_{k+1}A=\Bigl((d_k+f)\tan\alpha_k+(d_k-g)\tan\phi\Bigr)\cos\phi
$$

Наконец, рассмотрим прямоугольный $\triangle D_{k+1}E_{k+1}A$.  Имеет
место отношение

$$
\tan\alpha_{k+1}=\frac{D_{k+1}A}{D_{k+1}E_{k+1}}
$$ где $D_{k+1}E_{k+1}=d_{k+1}+f$.  Подставляя рассчитанные величины,
получаем:

\begin{equation}\label{eq:tan-alpha-far}
\tan\alpha_{k+1}=\displaystyle\frac{
\Bigl((d_k+f)\tan\alpha_k+(d_k-g)\tan\phi\Bigr)\cos\phi
}{
\Bigl((d_k+f)\tan\alpha_k\tan\phi+d_k-g\Bigr)\sin\phi-g+f
}
\end{equation}

Окончательное выражение зависимости угловой координаты ``далекого''
маяка в поле зрения робота при заданной постоянной скорости вращения
колес получим, подставляя в~\eqref{eq:tan-alpha-far} значение
\eqref{eq:g-computation} и заменяя $\phi=\omega\dt$:

\begin{equation}\label{eq:alpha-far}
\alpha_{k+1}=\arctan\displaystyle\frac{
\Bigl((d_k+f)\tan\alpha_k+
      (d_k-r\tan\frac{\omega\dt}{2})\tan\omega\dt\Bigr)
     \cos\omega\dt
}{
\Bigl((d_k+f)\tan\alpha_k\tan\omega\dt+
      d_k-r\tan\frac{\omega\dt}{2}\Bigr)\sin\omega\dt-
      r\tan\frac{\omega\dt}{2}+f
}
\end{equation}

Выражение зависимости $\omega$ и $r$ от $\omega_L$ и $\omega_R$
представлено в~\eqref{eq:moby-wheel-to-move}.

\subsection{Случай ``близкого'' расположения маяка}


% Конец Приложения
